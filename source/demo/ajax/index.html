<!DOCTYPE html>
<html>
<head>
    <title>ajax demo</title>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
</head>
<body>
    <button id="btn">点我发个请求</button>

    <script>

        function getXhr() {
            var xhr;
            try {
                xhr = new XMLHttpRequest();
            }
            catch(e) {
                var IEXHRVers = [
                    'Msxml3.XMLHTTP',
                    'Msxml2.XMLHTTP',
                    'Microsoft.XMLHTTP'
                ];
                for (var i = 0, len = IEXHRVers.length; i< len; i++) {
                    try {
                        xhr = new ActiveXObject(IEXHRVers[i]);
                    }
                    catch (e) {
                        continue;
                    }
                }
            }
            return xhr;
        }


        function ajax(options) {

            var xhr = getXhr();

            // open方法 创建一个新的http请求，并指定此请求的方法、URL以及验证信息(用户名/密码)
            xhr.open(options.method || 'get', options.url, true);

            // 第一个参数是请求方式,一般用get与post方法,与form标签的method类似
            // 第二个参数是请求的URL
            // 第三个参数是请求是同步进行还是异步进行,true表示异步
            // 调用了open方法仅仅是传递了参数而已

            function callback() {
                // 在这里面没有使用this.readyState这是因为IE下面ActiveXObject的特殊性
                if (xhr.readyState == 4) {// readyState表示文档加载进度,4表示完毕

                    console.log(xhr);

                    options.success(xhr.responseText); // responseText属性用来取得返回的文本
                }
            }

            xhr.onreadystatechange = callback;


            xhr.send(null);// 调用了send方法后才会发出请求
            // 并且get方式发送请求时send参数是null
        }


        $('#btn').on('click', function () {

            ajax({
                url: './data.json',
                method: 'get',
                success: function (responseText) {
                    console.log('xxx: ', responseText);
                }
            });
        });

    </script>

</body>
</html>